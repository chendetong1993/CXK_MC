<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>XX计算</title>
    <style type="text/css">
        @media (min-width: 1200px) {
            table {
                max-width: 400px;
            }
        }
        
        @media (min-width: 980px) {
            table {
                max-width: 400px;
            }
        }
        
        @media (min-width: 768px) and (max-width: 979px) {
            table {
                max-width: 400px;
            }
        }
        
        @media (max-width: 767px) {}
        
        @media (max-width: 480px) {}
        
        .table {
            width: 100%;
            border: 1px solid gray;
            margin: 4px
        }
        
        .table tr {
            width: 100%;
        }
        
        .table tr>th,
        .table tr>td {
            text-align: center;
        }
        
        .table tr>td[contenteditable="true"] {
            color: red;
        }
        
        .table tr>td {
            border-top: 1px solid lightgray;
        }
        
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }
        
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }
        
        .tab button:hover {
            background-color: #ddd;
        }
        
        .tab button.active {
            background-color: #ccc;
        }
        
        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
        }
    </style>
    <style id="cssTable"></style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;"/>
</head>

<body>
    <form id="pageLogin" style="display: block" onsubmit="loginIn();return false;">
        <label for="pwd">密码:</label>
        <input type="password" id="pwd" name="pwd">
        <input type="submit" value="确定">
    </form>
    <div id="pageMain" style="display: none">
        <div class="tab" id="tabMain">
        </div>
    </div>
    <script>
        let xListEncrypted = "0f14065146124e4d1705144415140f3a2e4b56425c151955560c411300555814025759434f1291a6b886d280564b191a57441d425904570a004440045912025718140f4393a5c4dfb2ee574d584d17151c441853175b014201531943035118144e14d0ece0d4cf81171c594b56425c151955560c411300555814430019124e1492b68e85ce87564b684d2e4b5640540d570a5677171c594b5640540d570a560745010743081c0f1450051c44560c41130055091a4e1c281c2f4d1717145c560c5674171c594b5640540d570a56020051574d584d1704115900140f150745114b584d483c596b0f14430019124e147643081c0f14430019124e140654574d584d5653510801124e424714104d584d483c596b0f14430019124e147143081c0f14025759434f1247071b54574d584d1704115900140f150745114b191a086d586d0f14430019124e147043081c0f14430019124e1404565b05564b191a5755105f00140f150745114b191a086d586d4e43035118140f433312091a4e43035118144e140443081c0f14430019124e1401574500564b191a086d586d4e1c594b091a0f4b191a5746155a175b5700564b683c591217575902570a5678400c27511a51111e044d557711426113275f03451d4858025d18530e077515555d491c104908546550152142225759491c1c54051941325500624737145c5c5f19414419541c547150152142225759491c1c54041c485c0b275341350766155a1d4c441c540558167b141862155852045d0158167204016406645a1606185d1b07485b5d15465c5f155c4b10335341350766155a1d085910471f1c4f0755104356045d181d0758165c535c0d4a5f044b441b1d041f505c194f141943164307140f435b44155418531515070e005e19415b4415545904554406084105554b54415c0501584e16175759025d0241131c5a081e0057570d101000440f0d1443001b56091c5c10080052151a175f0652501358441b460f4147400c16460e19591016570d14531f0d0914484d57094404175b0e1210574100570a2f6d4e430159005a50434f440643111a1717145c560c1784e5bd93918543081c0f144108015c11140f150745111a5640540d570a56d0a0d19cb7fb14484d0e12005f410d10124e424714101c5640155a175b57d5f9a3d1dac212091a4e430159005a50434f440643504d5746155a560c1787f58b908d8243086d586d4e43035118140f433412091a4e43035118144e1404524002564b191a5755105f41434f440643501c594b096b193a0e12025718140f433712091a4e43035118140f434d004014484d0e1211525c15570a00440153484d0e4d291a6e1a5746155a175b5773564b191a5746155a175b57054414091a4e4310541d42175b01420153484d0e4d291a6e1a5746155a175b5774564b584d1717145c560c1758431e4c14484d0e1211525c15570a00444004081c0f4b291a6e1a5746155a175b5775564b191a5746155a175b5701564b191a5746155a560c175341004414484d0e4d291a6e1a081c0f4b191a081c0f14430019124e144414483c281c5655540d16124e147b141862155852045d0158167204016406641b4146495c1d461f1b071a42315756095d59540b0b41265500624737145c5c5f5816064d5577114261132351181e5c4d55015d161f41325500624737145c5c5f581607485c194f65501521422257594958015816064d557e015b67001b57111e451a152610442044670e02435c1f18535c1e195745491c104908152610442044225759491c1c54051c485b421152400210185c5f044d5559461f085f1c015e075f5f074b44195d0d174d57530745175b571e0057570d101000440b151d1c54180057570d101000440b1511100f16420811441c0c1502145c171e075450194f4b5a42540319555442475b1951074218021d5918520b1511100f545a131155061b0059455b5502044e15121a5c1d5215031951175d0e1c574d58140c514c124e4d5652541514124e6d6e1a57441d425904570a004440045912025759434f1291a6f9d192d1574d584d17151c441853175b014201531943035118140f4393a5c4dff3b9171c594b56425c151955560c411300555814430019124e14d0ece0d4cf81564b191a57441d425904570a004440045912025759434f1292b68e85ce87564b291a6e1a5746155a175b5771564b191a5746155a175b570142030c43081c0f1411525c15570a00444004081c0f4b684d2e4b5640540d570a5674171c594b5640155a175b57054102171c594b5653510801124e424714104d584d483c596b0f14025759434f123714484d0e12025759434f124c01171c594b5653510801124e420643501c594b096b193a0e12025759434f123014484d0e12025759434f12400e564b191a5755105f41434f440643501c594b096b193a0e12025759434f123114091a4e43035118140f434412091a4e43035118140f4341094406171c594b096b586d4e1c594b091a4e1c594b5640540d570a5606171c286d581456001953560c5678400c27511a515049441c547150152142265942125d1959041c4f135f067315555d491c104908153210442044630019181d1a15525910335341350766155a5c5f19414419541c152610442044630019181d1a15535c195d0d660401640660155a1d4c441c540519413b451964540f12555c0719413255006247331a47071e5d1b07485b5d15461d08550d4a16720401640660540d5d59581606485c1e0653104356045d181d0719411c025d0b0b08441a451d5c535f015d1f0e435912174507140f435b441554590455440608410959105a42540319555442475f0154544d54415c0501584e16560019535c0400445c0b09184100175c111641134f5c1545001b56091c5c10084105554b16594705104259425a114f1046464d41065f185f1016570d14531f0d4843081c56070d5147124e4d1705144415140f3a2e4b56421d425904570a004440045912025759434f1291a6b886d280564b191a57441d421853175b014201531943035118140f4393a5c4dfb2ee574d584d17151c441853560c411300555814430019124e14d0ece0d4cf81171c594b56425c151955560c004440045912025759434f1292b68e85ce87564b684d2e4b5640540d570a5677564b191a5746155a175b570140000743081c0f1450051c44560c41130055091a0f4b684d2e4b5640540d570a5674171c594b5640540d570a56010252574d584d5653510801124e424714104d584d483c596b0f14430019124e147643081c0f14025759434f124c001b55574d584d1704115900140f150745114b191a086d586d0f14430019124e147143081c0f14430019124e1401525b02564b191a5755105f00140f150745114b191a086d586d4e43035118140f433012091a4e43035118144e140443081c0f14430019124e1403514500564b191a086d586d4e1c594b091a0f4b191a5746155a175b5700564b683c591217575902570a5678400c27511a51111e044d557711426113275f03451d4858025d18530e077515555d491c104908546550152142225759491c1c54051941325500624737145c5c5f19414419541c547150152142225759491c1c54041c485c0b275341350766155a1d4c441c540558167b141862155852045d0158167204016406645a1606185d1b07485b5d15465c5f155c4b10335341350766155a1d085910471f1c4f0755104356045d181d0758165c535c0d4a5f044b441b1d041f505c194f141943164307140f435b44155418531515070e005e19415b4415545904554406084105554b54415c0501584e16175759025d0241131c5a081e0057570d101000440f0d1443001b56091c5c10080052151a175f0652501358441b460f4147400c16460e19591016570d14531f0d0914484d57014c060c434f4b5652541514124e6d6e1a57441d425904570a004401531943035118140f4390a0f9d192d1574d584d17151c441853175b014201535814430019124e14d3f4c5d9f3b9171c594b56425c151955560c411300555814025759434f1291bba085ce87564b191a57441d425904570a004440045912025718140f4393b0cfd28ed6574d291a6e1a5746155a175b5771564b191a5746155a560c175044024114484d0e1211525c15570a00444004081c0f4b684d2e4b5640155a175b5772564b191a5746155a175b57064c07171c594b5653510801124e420643501c594b096b193a0e12025759434f123714484d0e12025759434f124206564b191a5755105f41434f440643501c594b096b193a0e12025759434f123014091a4e43035118140f434006564b191a5755105f41434f440643501c594b096b586d4e43035118140f433012091a4e43035118140f434602564b191a5755105f00140f150745114b191a086d586d4e43035118140f433312091a4e43035118144e140443081c0f14430019124e1400524500564b191a086d586d4e1c594b091a0f4b191a5746155a175b5700564b683c591217575902570a5678400c27511a51111e044d557711426113275f03451d4858025d18530e077515555d491c104908546550152142225759491c1c54051941325500624737145c5c5f19414419541c547150152142225759491c1c54041c485c0b275341350766155a1d4c441c540558167b141862155852045d0158167204016406645a1606185d1b07485b5d15465c5f155c4b10335341350766155a1d085910471f1c4f0755104356045d181d0758165c535c0d4a5f044b441b1d041f505c194f141943164307140f435b44155418531515070e005e19415b4415545904554406084105554b54415c0501584e16175759025d0241131c5a081e0057570d101000440f0d1443001b56091c5c10080052151a175f0652501358441b460f4147400c16460e19591016570d14531f0d0914484d57024c060c434f4b5652541514124e6d6e1a57441d425904570a004401531943035118140f4390a0f9d192d1574d584d17151c441853175b014201535814430019124e14d3f4c5d9f3b9171c594b56425c151955560c411300555814025759434f1291bba085ce87564b191a57441d425904570a004440045912025718140f4393b0cfd28ed6574d291a6e1a5746155a175b5771564b191a5746155a560c175040064614484d0e1211525c15570a00444004081c0f4b684d2e4b5640155a175b5772564b191a5746155a175b57054306171c594b5653510801124e420643501c594b096b193a0e12025759434f123714484d0e12025759434f12450444180243081c0f1450051c44560c41130055091a4e1c281c2f4d1717145c560c5672171c594b5640540d570a5603064f4507564b191a5755105f41434f440643114b191a086d586d4e43035118140f433012091a4e43035118140f4347045a074014484d0e1211525c15570a00444004081c0f4b684d2e4b5640540d570a5670564b191a5746155a175b5701564b191a5746155a175b570743040543081c0f4b291a6e1a081c0f4b191a081c0f14430019124e140543086d291a1702145c17144e147b141862155852045d0158167204016406645a1606185d1b07485b561b44315756095d59540b0b41265500624737145c5c5f1941461c5471501521422257181e5c4d55015d161f41325500624737145c5c5f194147195d1f0e32104420442257594958015816064d557e015b67001b57111e044d557711426113275f03455c1f18535c1e195745491c104908152610442044630019181d1a15525c195a441152400210185c5f044d5559461f085f1c015e071e08471a451f1c5a571c56550745175b571e0057570d101000440b151d1c54184100175c111641134b4410160f16420811441c0c1502145c171e075450194f4b1b15145218531515070a1857074218021d5918520b1511100f545a131155061b410e050a5404451955431b5a1d5215031951175d0e1c574d58146d50570a0f1451000151560c6e3a0e12005f005a50434f440643504d5746155a175b57d5e4bbd2c6c512091a4e430159005a11140f150745111a1717145c560c1787e0809db1ba43081c0f144108015c11144e424714101c5640540d570a56d3b8f4918bc314484d0e12005f410d10124e420643504d5746155a175b57d6f48dd1dac212096b193a0e12025759434f123514091a4e43035118140f434c054d14484d0e1211525c15570a00444004081c0f4b291a6e1a5746155a175b5772564b191a5746155a175b57084c01171c594b5653105f41434f440643501c594b096b193a0e12025759434f123714484d0e12025718140f4347074114484d0e1211525c15570a00444004081c0f4b684d2e4b5640155a175b5774564b191a5746155a175b57064114484d0e1211525c15570a00440153484d0e4d291a6e1a5746155a175b5775564b191a5746155a175b57084614091a4e4310541d42175b01420153484d0e4d291a6e1a5746155a175b5776564b584d1717145c560c1750574d584d1717145c560c17524c004414484d0e4d291a2f4d484d0e4d584d484d0e12025759434f124414483c281c5655540d16124e143a435833145e13531d5059103353413507621b4146495c1d461f1b071a423157175e1d08550d4a16660401640660540d5d595816064d5577114261132351181e1d1a15505c105e16720401640660540d5d59581607485c194f65501521422257181e18505910471a152f005d26575b061018451a152610442044670e02435c1f59041c4f1851041e5c41480e547150152142225759491c1c54051c485b421152015550495d59451a1508471949085c505f015f5f074b44195d0d174d57530745560c174f0151165a504101424a425d4d551e0057570d101000440b1511100f16035f51151d0a5455540d1618460310484e4d5a42540319555442475b1951074259555d0819544a4251410e521b445104071d0059455b5502044e15121a5c1d5254545900165b4f4b171c59124d060c23570a0f1451000151560c6e3a0e12005f005a50434f440643504d5746155a175b57d5e4bbd2c6c512091a4e430159005a11140f150745111a1717145c560c1787e0809db1ba43081c0f144108015c11144e424714101c5640540d570a56d3b8f4918bc314484d0e12005f410d10124e420643504d5746155a175b57d6f48dd1dac212096b193a0e12025759434f123514091a4e43035118140f434406410f171c594b5653510801124e424714104d584d096b193a0e12025759434f123614484d0e12025759434f1241030143081c0f1411525c15570a00444004081c0f4b684d2e4b5640540d570a5675171c594b5640155a175b57084314484d0e1211525c15570a00444004081c0f4b684d2e4b5640155a175b5774564b191a5746155a175b57044c14484d0e1211525c15570a00440153484d0e4d291a6e1a5746155a175b5775564b191a5746155a175b5701564b584d1717145c560c175646004414484d0e4d291a6e1a081c0f4b191a081c0f14025759434f124414483c281c5655540d16124e147b141862155852045d0158163353413507621b4146495c1d461f1b071a42315756095d59540b0b41265500620660540d5d595816064d5577114261132351181e5c4d55015d161f41325500620660540d5d59581607485c194f65501521422257594958015816064d557e015b26575b061018451a152610442044670e02435c1f18535c1e195745491c104908547150152142225759491c1c54051c485b421152400210185c5f044d5559461f49085c505f015f5f074b44195d0d174d57530745175b571e0057570d101000444a425d4d551e0057570d101000440b1511100f16420811441c0c1502145c171e460310484e4d5a42540319555442475b1951074218021d5918520b1511100f541b445104071d0059455b5502044e15121a5c1d5215031951175d0e1c574d09";
        let xList = null;

        function XorDecrypt(key, cyphertext) {
            try {
                cyphertext = cyphertext.match(/.{1,2}/g).map(x => parseInt(x, 16));
                let plaintext = [];
                for (let i = 0; i < cyphertext.length; i++) {
                    plaintext.push((cyphertext[i] ^ key.charCodeAt(Math.floor(i % key.length))).toString(16).padStart(2, '0'));
                }
                return decodeURIComponent('%' + plaintext.join('').match(/.{1,2}/g).join('%'));
            } catch (e) {
                return false;
            }
        }

        function XorPasswordDerivedKey(password, salt, iterations, len) {
            if (!salt) salt = '80ymb4oZ';
            if (!iterations) iterations = 8;
            if (!len) len = 256;
            len = Math.ceil(len / 8);
            let key = '',
                i = 0,
                j = 0,
                h = 0,
                k = 0,
                intSalt = salt,
                newSalt = '',
                intKey = '';

            while (key.length < len) {
                intSalt = salt;
                for (i = 0; i < iterations; i++) {
                    intKey = password + intSalt;
                    //hash
                    for (k = 0, h = 4641154056; k < intKey.length; k++)
                        h = Math.imul(h + intKey.charCodeAt(k) | 0, 2654435761);
                    intKey = ((h ^ h >>> 17) >>> 0).toString(36);

                    for (j = 0, newSalt = ''; j < intSalt.length; j++) {
                        newSalt += (intSalt.charCodeAt(j) ^ intKey.charCodeAt(Math.floor(j % intKey.length))).toString(36);
                    }
                    intSalt = newSalt;
                }
                key += intKey;
            }
            return key.substring(0, len);
        }

        function tryLoginIn() {
            let password = sessionStorage.getItem("pwd");
            if (password) {
                document.getElementById("pwd").value = password;
                loginIn();
            }
        }

        function loginIn() {
            try {
                let password = document.getElementById("pwd").value;
                let xList_decrypted = XorDecrypt(XorPasswordDerivedKey(password), xListEncrypted);
                if (!xList_decrypted) {
                    throw "Password Err";
                }
                xList = JSON.parse(xList_decrypted);
                let elem_page_login = document.getElementById("pageLogin");
                let elem_page_main = document.getElementById("pageMain");
                elem_page_login.style.display = "none";
                elem_page_main.style.display = "block";
                initTab();
                sessionStorage.setItem("pwd", password);
            } catch (e) {
                console.log(e);
                alert("密码不正确");
            }
        }

        function initTab() {
            let elem_tab = document.getElementById("tabMain");
            for (let key in xList) {
                let elem_button = document.createElement("button");
                elem_button.classList.add("tablinks");
                elem_button.classList.add(key);
                elem_button.innerHTML = key;
                elem_button.setAttribute("onclick", 'javascript:openTab("' + key + '");');
                elem_tab.appendChild(elem_button);
            }
            for (let key in xList) {
                let elem_tab_content = document.createElement("div");
                elem_tab_content.classList.add("tabcontent");
                elem_tab_content.classList.add(key);

                let elem_table = document.createElement("table");
                elem_table.classList.add("table");
                elem_table.classList.add(key);

                for (let v1 of xList[key]["data"]) {
                    let elem_tr = elem_table.insertRow();
                    for (let v2 of v1) {
                        let elem_td = document.createElement(v2["title"] ? "th" : "td");
                        elem_td.innerHTML = v2["val"] ? v2["val"] : "";
                        if (v2["edit"]) {
                            elem_td.setAttribute("contenteditable", "true");
                            elem_td.setAttribute("onkeyup", 'javascript:calcTable("' + key + '");');
                        }
                        elem_tr.appendChild(elem_td);
                    }
                }
                elem_tab_content.appendChild(elem_table);
                elem_tab.parentElement.appendChild(elem_tab_content);
            }
            elem_tab.children[0].click();
        }

        function openTab(key) {
            for (let v of document.getElementsByClassName("tablinks")) {
                if (v.classList.contains(key)) {
                    v.classList.add("active");
                } else {
                    v.classList.remove("active");
                }
            }
            for (let v of document.getElementsByClassName("tabcontent")) {
                if (v.classList.contains(key)) {
                    v.style.display = "block";
                } else {
                    v.style.display = "none";
                }
            }
            document.getElementById("cssTable").innerHTML = xList[key]["css"];
            calcTable(key);
        }

        function calcTable(key) {
            let tabElem = document.getElementsByClassName("table " + key)[0];
            let GetTrVal = function(row, col) {
                row = (row + tabElem.rows.length) % tabElem.rows.length;
                col = (col + tabElem.rows[row].cells.length) % tabElem.rows[row].cells.length;
                return tabElem.rows[row].cells.item(col).innerHTML;
            }
            let SetTrVal = function(row, col, val, decimal_place = 2) {
                row = (row + tabElem.rows.length) % tabElem.rows.length;
                col = (col + tabElem.rows[row].cells.length) % tabElem.rows[row].cells.length;
                tabElem.rows[row].cells.item(col).innerHTML =
                    (Number(val) === val && val % 1 !== 0) ?
                    val.toFixed(decimal_place) :
                    val;
            }
            let GetTrRows = function() {
                return tabElem.rows.length;
            }
            let GetTrCols = function(row) {
                row = (row + tabElem.rows.length) % tabElem.rows.length;
                return tabElem.rows[row].cells.length;
            }
            let NumRange = function(start, end) {
                return [...Array(end - start + 1).keys()].map(x => x + start);
            }
            eval(xList[key]["calc"]);
        }
        tryLoginIn();
    </script>
</body>

</html>
